# DataBridgeCH

- **Сопоставленные таблицы MSSQL** :
  | Объект 1С | MSSQL таблица | Размер (КБ) | Примечание |
  |---|---|---|---|
  | РегистрСведений.ЦеныПоступленияСредние | dbo._InfoRg6453 | 15277984 | Для средних цен поступления (СрезПоследних) |
  | РегистрНакопления.ДвижениеТМЦ | dbo._AccumRg5628 | 71519544 | Обороты по ТМЦ (продажи, возвраты) |
  | РегистрНакопления.ПартииНоменклатуры | dbo._AccumRg5998 | 76862304 | Остатки и обороты партий |
  | РегистрНакопления.РР_ВозвратныйБрак | dbo._AccumRg10970 | 594312 | Остатки брака |
  | РегистрСведений.ЦеныНоменклатуры | dbo._InfoRg5404 | 898024 | Прайсовые цены (СрезПоследних) |
  | РегистрСведений.ЦеныНоменклатурыЗакупочные | dbo._InfoRg5415 | 22572280 | Закупочные цены |
  | РегистрСведений.ЗначенияСвойствОбъектов | dbo._InfoRg4432 | 3760176 | Характеристики номенклатуры |
- **Дополнительно нужны (неявно)**: Справочник.Номенклатура (для полей как БазоваяЕдиницаИзмерения, СС_ОсновнойПоставщик; в файле возможно _ReferenceXX, но не указано явно - уточнить). Справочник.Склады (для МестоХранения, СтруктурнаяЕдиница; возможно _ReferenceXX). ПланВидовХарактеристик.СвойстваОбъектов (для видов характеристик; возможно _ChrcXX).



## Архитектура (предлагаемая структура БД в ClickHouse)

```
default (или отдельная БД: onec)
├── dim_nomenclature          -- Справочник.Номенклатура
├── dim_warehouses            -- Справочник.Склады / СтруктурныеЕдиницы
├── fact_movements_tmc        -- РегистрНакопления.ДвижениеТМЦ (обороты)
├── fact_parties              -- РегистрНакопления.ПартииНоменклатуры (остатки и обороты)
├── fact_defective_return     -- РегистрНакопления.РР_ВозвратныйБрак
├── dim_prices_incoming_avg   -- РегистрСведений.ЦеныПоступленияСредние (срез последних)
├── dim_prices_retail         -- РегистрСведений.ЦеныНоменклатуры (прайсовые)
├── dim_prices_purchase       -- РегистрСведений.ЦеныНоменклатурыЗакупочные
├── dim_properties_values     -- РегистрСведений.ЗначенияСвойствОбъектов (характеристики номенклатуры)
└── mv_*                      -- Materialized Views для предвычисленных отчётов (опционально)
```

## Предлагаемое правило нейминга таблиц в ClickHouse

| Тип объекта 1С                  | Префикс в CH          | Пример исходной таблицы MSSQL | Финальное имя таблицы в CH                  | Комментарий |
|--------------------------------|-----------------------|-------------------------------|---------------------------------------------|-------------|
| Справочник.*                   | dim_                  | dbo.Reference379          | dim_goods                            | Дименшн-таблицы, медленно меняются |
| Справочник.Склады / СтруктурныеЕдиницы | dim_           | dbo.Reference484              | dim_warehouses                              | |
| РегистрНакопления.* (обороты)  | fact_                 | dbo._AccumRg5628              | fact_movements_tmc                          | Факт-таблицы с оборотами |
| РегистрНакопления.* (остатки)   | fact_                 | dbo._AccumRg5998              | fact_parties                                | |
| РегистрНакопления.РР_ВозвратныйБрак | fact_             | dbo._AccumRg10970             | fact_defective_return                       | |
| РегистрСведений.* (срезы последних) | dim_             | dbo._InfoRg6453               | dim_prices_incoming_avg                     | Медленно меняющиеся цены |
| РегистрСведений.ЦеныНоменклатуры | dim_                | dbo._InfoRg5404               | dim_prices_retail                           | |
| РегистрСведений.ЦеныНоменклатурыЗакупочные | dim_       | dbo._InfoRg5415               | dim_prices_purchase                         | |
| РегистрСведений.ЗначенияСвойствОбъектов | dim_         | dbo._InfoRg4432               | dim_properties_values                       | Характеристики |

### Почему такая конвенция?
- **dim_** — dimension tables (справочники и срезы последних регистров сведений). Подходят для ReplacingMergeTree или VersionedCollapsingMergeTree.
- **fact_** — fact tables (регистры накопления с оборотами/остатками). Обычно MergeTree с партиционированием по дате (Date).
- Читаемые английские имена → проще писать запросы в аналитике (Superset, Metabase, raw SQL).
- snake_case → стандарт ClickHouse.
- Нет префиксов _AccumRg / _InfoRg → избавляемся от технических артефактов 1С.
